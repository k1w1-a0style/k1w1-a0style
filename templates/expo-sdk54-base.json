{
  "path": ".github/workflows/deploy-supabase-functions.yml",
  "content": "name: K1W1 Build Workflow\n\non:\n  workflow_dispatch:\n    inputs:\n      job_id:\n        description: 'Die Supabase job_id'\n        required: true\n        type: string\n\njobs:\n  run-eas-build:\n    runs-on: ubuntu-latest\n\n    env:\n      SUPABASE_URL: ${{ secrets.SUPABASE_URL }}\n      SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}\n      JOB_ID: ${{ github.event.inputs.job_id }}\n\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Validate Job ID\n        run: |\n          if [ -z \"$JOB_ID\" ]; then\n            echo \"::error::Job ID fehlt!\"\n            exit 1\n          fi\n          echo \"âœ“ Job ID: $JOB_ID\"\n\n      - name: Setup Node\n        uses: actions/setup-node@v4\n        with:\n          node-version: 18.x\n\n      - name: Setup EAS\n        uses: expo/expo-github-action@v8\n        with:\n          expo-version: latest\n          eas-version: latest\n          token: ${{ secrets.EXPO_TOKEN }}\n\n      - name: Install dependencies\n        run: npm install\n\n      - name: Update Build Status - Building\n        run: |\n          curl -X PATCH \"${SUPABASE_URL}/rest/v1/build_jobs?id=eq.${JOB_ID}\" \\\n            -H \"apikey: ${SUPABASE_SERVICE_ROLE_KEY}\" \\\n            -H \"Authorization: Bearer ${SUPABASE_SERVICE_ROLE_KEY}\" \\\n            -H \"Content-Type: application/json\" \\\n            -d \"{\\\"status\\\":\\\"building\\\",\\\"github_run_id\\\":\\\"${{ github.run_id }}\\\"}\"\n\n      - name: Run EAS Build\n        id: eas\n        run: |\n          BUILD_OUTPUT=$(eas build --platform android --non-interactive --no-wait 2>&1)\n          echo \"$BUILD_OUTPUT\"\n          BUILD_ID=$(echo \"$BUILD_OUTPUT\" | grep -oP 'Build ID: \\K[a-f0-9-]+' || echo \"unknown\")\n          echo \"build_id=$BUILD_ID\" >> $GITHUB_OUTPUT\n\n      - name: Update Build Status - Success\n        if: success()\n        run: |\n          curl -X PATCH \"${SUPABASE_URL}/rest/v1/build_jobs?id=eq.${JOB_ID}\" \\\n            -H \"apikey: ${SUPABASE_SERVICE_ROLE_KEY}\" \\\n            -H \"Authorization: Bearer ${SUPABASE_SERVICE_ROLE_KEY}\" \\\n            -H \"Content-Type: application/json\" \\\n            -d \"{\\\"status\\\":\\\"completed\\\",\\\"eas_build_id\\\":\\\"${{ steps.eas.outputs.build_id }}\\\"}\"\n\n      - name: Update Build Status - Failed\n        if: failure()\n        run: |\n          curl -X PATCH \"${SUPABASE_URL}/rest/v1/build_jobs?id=eq.${JOB_ID}\" \\\n            -H \"apikey: ${SUPABASE_SERVICE_ROLE_KEY}\" \\\n            -H \"Authorization: Bearer ${SUPABASE_SERVICE_ROLE_KEY}\" \\\n            -H \"Content-Type: application/json\" \\\n            -d \"{\\\"status\\\":\\\"error\\\",\\\"github_run_id\\\":\\\"${{ github.run_id }}\\\"}\"\n"
}
